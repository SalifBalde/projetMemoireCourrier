<p-toast></p-toast>
<form [formGroup]="form" (ngSubmit)="saveReception()">
    <div class="grid">
        <div class="col-12">
            <div class="card px-6 py-6">
                <h4>Liste des colis à réceptionner</h4>
                <p-table [value]="ecommerce$" [(selection)]="selectedEcommerce" dataKey="id"
                    [tableStyle]="{'min-width': '50rem'}">
                    <ng-template pTemplate="header">
                        <tr>
                            <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
                            <th>Numéro d'envoi</th>
                            <th>Partenaire</th>
                            <th>Nom complet client</th>
                            <th>Téléphone</th>
                            <th>Bureau Expedition</th>
                            <th>Bureau Destination</th>
                            <th>Retourner</th>
                            <th>Date</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-ecommerce>
                        <tr>
                            <td><p-tableCheckbox [value]="ecommerce"></p-tableCheckbox></td>
                            <td>{{ ecommerce.numenvoi }}</td>
                            <td>{{ ecommerce.partenaireLibelle}}</td>
                            <td>{{ ecommerce.prenomClient }} {{ ecommerce.nomClient }}</td>
                            <td>{{ ecommerce.telephoneClient }}</td>
                            <td>{{ecommerce.partenaireBureauLibelle}}</td>
                            <td>{{ecommerce.bureauDestinationLibelle}}</td>
                            <td>
                                <p-tag
                                  [value]="ecommerce.retourner ? 'Oui' : 'Non'"
                                  [severity]="ecommerce.retourner ? 'danger' : 'success'">
                                </p-tag>
                              </td>

                              <td>{{ ecommerce.dateexp | date: 'dd/MM/yyyy' }}</td>
                        </tr>
                    </ng-template>
                </p-table>
                <div class="col-12 flex flex-column lg:flex-row justify-content-end align-items-center">
                    <button pButton class="p-element p-button-primary lg:w-auto flex-order-1" type="button">
                        <span class="p-button-label" (click)="openDialog()">Receptionner</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>

<p-dialog [(visible)]="openEcommerceDialog" header="Confirmer" [modal]="true" [style]="{width:'450px'}">
    <div class="flex align-items-center justify-content-center">
        <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
        <span>
            Êtes-vous sûr de vouloir réceptionner <b>{{ selectedEcommerce.length }}</b> envoi{{ selectedEcommerce.length > 1 ? 's' : '' }} ?
        </span>
    </div>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text p-button-danger" label="Annuler"
            (click)="openEcommerceDialog = false"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text p-button-success" label="Valider"
            (click)="confirmReception()"></button>
    </ng-template>
</p-dialog>
<div *ngIf="loading" class="loading-message">
    <p>Chargement, veuillez patienter...</p>
</div>
