
<div class="p-fluid grid">
    <p-toast></p-toast>

    <div class="col-12 lg:col-6 md:px-1">
        <div class="card">
            <div class="grid formgrid">
                <div class="col-12 field">
                                <span class="text-900 text-xl block font-medium mb-3"> <p-button
                                    icon="pi pi-user-plus" label="Ajouter Expéditeur" severity="success" (click)="openClient()" /></span>
                </div>
                <div class="col-12 lg:col-6 field">
                                <span class="p-float-label">
                                    <input id="float-input" disabled type="text" value="{{client.nom}}   {{client.prenom}}" pInputText
                                           readonly />
                                    <input style="display: none;" formControlName="expediteurId" id="float-input"
                                           type="text" pInputText />
                                    <label for="float-input">Nom complet</label>
                                </span>
                </div>
                <div class="col-12 lg:col-6 field">
                                <span class="p-float-label">
                                    <input id="float-input" disabled type="text" value="{{client.cni}}" pInputText
                                           readonly />
                                    <label for="float-input">Cni</label>
                                </span>
                </div>
            </div>
        </div>

    </div>
    <div class="col-12 lg:col-6 md:px-1">
        <div class="card">
            <div class="grid formgrid">
                <div class="col-12 field">
                                <span class="text-100 text-xl block font-medium mb-3"><p-button
                                    icon="pi pi-user-plus" label="Ajouter Destinataire" severity="success" (click)="openDestinataire()" /></span>
                </div>
                <div class="col-12 lg:col-6 field">
                                <span class="p-float-label">
                                    <input id="float-input" disabled type="text" value="{{ destinataire.nom}}  {{ destinataire.prenom}}"
                                           pInputText readonly />
                                    <input style="display: none;" formControlName="destinataireId" id="float-input"
                                           type="text" pInputText />
                                    <label for="float-input">Nom complet</label>
                                </span>
                </div>
                <div class="col-12 lg:col-6 field">
                                <span class="p-float-label">
                                    <input id="float-input" disabled type="text" value="{{ destinataire.cni}}"
                                           pInputText readonly />
                                    <label for="float-input">Cin</label>
                                </span>
                </div>
            </div>
        </div>

    </div>
    <div class="col-12 lg:col-8 ">
        <div class="card">
            <div class="grid formgrid align-items-center">
                <!-- Titre de la section -->
                <div class="col-12 field">
                <span class="text-900 text-xl block font-medium mb-1">
                    Informations Packet
                </span>
                </div>

                <!-- Dropdown Pays -->
                <div class="col-12 lg:col-6 field">
                    <p-dropdown
                        [options]="pays$"
                        optionLabel="libelle"
                        optionValue="id"
                        [filter]="true"
                        filterBy="libelle"
                        [(ngModel)]="paysDestinationId"

                        [showClear]="true"
                        placeholder="Choisir Pays">
                        <ng-template pTemplate="selectedItem" let-selectedOption>
                            <div class="flex align-items-center gap-2">
                                <div>{{ selectedOption.libelle }}</div>
                            </div>
                        </ng-template>
                        <ng-template let-structure pTemplate="item">
                            <div class="flex align-items-center gap-2">
                                <div>{{ structure.libelle }}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>

                <!-- Dropdown Catégorie -->
                <div class="col-12 lg:col-6 field">
                    <p-dropdown
                        [options]="categorie$"
                        optionLabel="libelle"
                        optionValue="id"
                        [filter]="true"
                        filterBy="libelle"

                        [(ngModel)]="categorieId"
                        [showClear]="true"
                        placeholder="Choisir Catégorie">
                        <ng-template pTemplate="selectedItem" let-selectedOption>
                            <div class="flex align-items-center gap-2">
                                <div>{{ selectedOption.libelle }}</div>
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
                <!-- Espace ajouté entre "Catégorie" et "Poids" -->
                <div class="col-12 mt-6"></div>

                <!-- Champ Poids -->
                <div class="col-12 lg:col-6 field">
                <span class="p-float-label">
                    <input type="number" pInputText  [(ngModel)]="poids" />
                    <label for="poids">Poids (g)</label>
                </span>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <span class="p-float-label">
                        <p-inputGroup>
                              <input id="codebarre" placeholder="Code barre" [(ngModel)]="codebarre"
                                     pInputText pKeyFilter="alphanum" maxlength="13" minlength="13"
                                     (input)="validateCodeBarre()" class="p-inputtext"
                                     #codebarreInput="ngModel" required />
                                <small class="p-error" *ngIf="codebarreInput.invalid && codebarreInput.touched">
                                    Le code-barre doit contenir exactement 13 caractères (chiffres et lettres).
                                </small>
                        </p-inputGroup>
                       </span>

                    <button pButton type="button" (click)="generateCodeBarre()" class="p-button p-button-secondary mt-2">
                        Générer un Code-Barre
                    </button>
                </div>

            </div>
        </div>
    </div>


<!--    <div class="col-3 lg:col-offset-3 field " style="float:right">-->
<!--        <p-button (click)="saveColis()"  [disabled]=" !paysDestinationId  || !poids || !codebarre  " label="Enregistrer" severity="info" />-->
<!--    </div>-->

</div>


<p-dialog [(visible)]="clientDialog" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }" [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false" header="Ajouter" [modal]="true" class="p-fluid">

    <form [formGroup]="formClient" (ngSubmit)="saveClient()">
        <div class="row">
            <div class="grid formgrid">
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Téléphone:</label>
                        <input pInputText  pKeyFilter="num"  id="telephone"   (input)="searchClient()" formControlName="telephone"
                               class="flex-auto" autocomplete="off" />
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Cni:</label>
                        <input pInputText id="cni" formControlName="cni" class="flex-auto" autocomplete="off" />
                    </div>
                </div>


                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Nom:</label>
                        <input pInputText id="nom" formControlName="nom" class="flex-auto" autocomplete="off" />
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Prénom:</label>
                        <input pInputText id="prenom" formControlName="prenom" class="flex-auto" autocomplete="off" />
                    </div>
                </div>

                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Adresse:</label>
                        <input pInputText id="adresse" formControlName="adresse" class="flex-auto" autocomplete="off" />
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Email:</label>
                        <input pInputText id="email" formControlName="email" class="flex-auto" autocomplete="off" />
                    </div>
                </div>

            </div>
        </div>

        <div class="flex justify-content-end gap-2">
            <p-button label="Cancel" (click)="hideDialog()" severity="danger" />
            <p-button (click)="saveClient()" [disabled]="formClient.invalid" label="Valider" severity="success" />
        </div>
    </form>
</p-dialog>

<p-dialog [(visible)]="destinataireDialog" [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
          [style]="{ width: '50vw' }" [draggable]="false" [resizable]="false" header="Ajouter" [modal]="true" class="p-fluid">
    <h4>Destinataire du pays:</h4>
    <hr>
    <form [formGroup]="formDestinataire" (ngSubmit)="saveDestinataire()">
        <div class="row">
            <div class="grid formgrid">
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Téléphone:</label>
                        <input pInputText  pKeyFilter="num"  id="telephone" (input)="searchDestinataire()" formControlName="telephone"
                               class="flex-auto" autocomplete="off" />
<!--                        (input)="searchDestinataire()"-->
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Cni:</label>
                        <input pInputText id="cni" formControlName="cni" class="flex-auto" autocomplete="off" />
                    </div>
                </div>


                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Nom:</label>
                        <input pInputText id="nom" formControlName="nom" class="flex-auto" autocomplete="off" />
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Prénom:</label>
                        <input pInputText id="prenom" formControlName="prenom" class="flex-auto" autocomplete="off" />
                    </div>
                </div>

                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Adresse:</label>
                        <input pInputText id="adresse" formControlName="adresse" class="flex-auto" autocomplete="off" />
                    </div>
                </div>
                <div class="col-12 mb-2 lg:col-6 lg:mb-3">
                    <div class="flex align-items-center">
                        <label for="cni" class="font-semibold w-6rem">Email:</label>
                        <input pInputText id="email" formControlName="email" class="flex-auto" autocomplete="off" />
                    </div>
                </div>

            </div>
        </div>

        <div class="flex justify-content-end gap-2">
            <p-button label="Cancel" (click)="hideDialog()" severity="danger" />
            <p-button (click)="saveDestinataire()" [disabled]="formDestinataire.invalid" label="Valider"
                      severity="success" />
        </div>
    </form>
</p-dialog>

<!-- Section Prévisualisation -->
<div class="col-6">
    <div class="card">
        <h3>Résumé des Données Saisies</h3>
        <div class="grid">
            <div class="col-12 lg:col-6">
                <p><strong>Expéditeur:</strong> {{ client.nom }} {{ client.prenom }}</p>
                <p><strong>CNI Expéditeur:</strong> {{ client.cni }}</p>
            </div>
            <div class="col-12 lg:col-6">
                <p><strong>Destinataire:</strong> {{ destinataire.nom }} {{ destinataire.prenom }}</p>
                <p><strong>CNI Destinataire:</strong> {{ destinataire.cni }}</p>
            </div>
            <div class="col-12">
                <p><strong>Pays d'origine :</strong> {{ getPaysLibelle(paysDestinationId) }}</p>
                <p><strong>Catégorie:</strong> {{ getCategorieLibelle(categorieId) }}</p>
                <p><strong>Poids:</strong> {{ poids }} g</p>
                <p><strong>Code barre:</strong> {{ codebarre }}</p>
            </div>
            <!-- Bouton Enregistrer -->
            <div class="col-6 lg:col-offset-6 field" style="float:right">
                <p-button (click)="saveColis()" [disabled]="!paysDestinationId || !poids || !codebarre" label="Enregistrer" severity="info" />
            </div>
        </div>

    </div>

</div>





