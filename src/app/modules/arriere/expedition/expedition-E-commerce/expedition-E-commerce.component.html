<p-toast></p-toast>
<form [formGroup]="form" (ngSubmit)="saveExpedition()">

    <div class="card p-fluid">
        <h4>Liste des envoies E-commerce à expédier</h4>
        <div class="p-formgrid grid justify-content-center">
            <div class="field col-4">
                <label for="bureauDestination">Destination</label>
                <p-dropdown [options]="structure$" optionLabel="libelle" optionValue="id" [filter]="true" filterBy="libelle"
                    formControlName="bureauDestination" [showClear]="true" placeholder="Choisissez un bureau"
                    aria-label="Choisissez un bureau">
                    <ng-template pTemplate="selectedItem" let-selectedOption>
                        <div class="flex align-items-center gap-2">
                            <div>{{ selectedOption.libelle }}</div>
                        </div>
                    </ng-template>
                    <ng-template let-structure pTemplate="item">
                        <div class="flex align-items-center gap-2">
                            <div>{{ structure.libelle }}</div>
                        </div>
                    </ng-template>
                </p-dropdown>
                <div *ngIf="form.get('bureauDestination')?.invalid && form.get('bureauDestination')?.touched"
                    class="error-message">
                    Veuillez sélectionner une destination.
                </div>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="col-12">
            <div class="card px-6 py-6">
                <p-table [value]="ecommerce$" dataKey="id" [tableStyle]="{ 'min-width': '50rem' }"
                    selectionMode="checkbox" [(selection)]="selectedEcommerce">
                    <ng-template pTemplate="header">
                        <tr>
                          <th><p-tableHeaderCheckbox></p-tableHeaderCheckbox></th>
                          <th>Numéro d'envoi</th>
                          <th>Partenaire</th>
                          <th>Nom complet client</th>
                          <th>Téléphone</th>
                          <th>Bureau Expedition</th>
                          <th>Bureau Destination</th>
                          <th>Retourner</th>
                          <th>Date</th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-ecommerce>
                        <tr>
                          <td><p-tableCheckbox [value]="ecommerce"></p-tableCheckbox></td>
                          <td>{{ ecommerce.numenvoi }}</td>
                          <td>{{ ecommerce.partenaireLibelle}}</td>
                          <td>{{ ecommerce.prenomClient }} {{ ecommerce.nomClient }}</td>
                          <td>{{ ecommerce.telephoneClient }}</td>
                          <td>{{ecommerce.partenaireBureauLibelle}}</td>
                          <td>{{ecommerce.bureauDestinationLibelle}}</td>
                          <td>
                            <p-tag
                              [value]="ecommerce.retourner ? 'Oui' : 'Non'"
                              [severity]="ecommerce.retourner ? 'danger' : 'success'">
                            </p-tag>
                          </td>

                          <td>{{ ecommerce.dateexp | date: 'dd/MM/yyyy' }}</td>
                        </tr>
                      </ng-template>
                </p-table>
                <div class="col-12 flex flex-column lg:flex-row justify-content-end align-items-center">
                    <button pButton class="p-element p-button-primary lg:w-auto flex-order-1" type="button"
                        (click)="saveExpedition()" [disabled]="form.invalid || selectedEcommerce.length === 0">
                        <span class="p-button-icon p-button-icon-left pi pi-fw pi-check"></span>
                        <span class="p-button-label">Sauvegarder</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>
<div *ngIf="loading" class="loading-message">
    <p>Chargement, veuillez patienter...</p>
</div>
